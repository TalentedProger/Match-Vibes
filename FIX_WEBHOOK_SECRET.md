# üîí –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ TELEGRAM_WEBHOOK_SECRET

**–î–∞—Ç–∞:** 9 —è–Ω–≤–∞—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** Invalid webhook secret token (401 –æ—à–∏–±–∫–∏)

---

## üéØ –ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å

1. ‚úÖ –í—ã –¥–æ–±–∞–≤–∏–ª–∏ `TELEGRAM_WEBHOOK_SECRET` –≤ Vercel
2. ‚ùå Webhook –±—ã–ª –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ë–ï–ó –ø–µ—Ä–µ–¥–∞—á–∏ secret –≤ Telegram
3. ‚ùå Telegram –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ secret —Ç–æ–∫–µ–Ω
4. ‚ùå Vercel –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω ‚Üí –æ—à–∏–±–∫–∞ 401

**–†–µ—à–µ–Ω–∏–µ:** –ù—É–∂–Ω–æ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook –° secret_token –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º.

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (2 —à–∞–≥–∞)

### –®–∞–≥ 1: –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ .env.local

–û—Ç–∫—Ä–æ–π—Ç–µ (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ) —Ñ–∞–π–ª `.env.local` –∏ –¥–æ–±–∞–≤—å—Ç–µ:

```bash
TELEGRAM_WEBHOOK_SECRET=GlUM1AuhKRYprvEcOHw2xe0Sb9jgWfyi
```

**–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—Ç –∂–µ —Ç–æ–∫–µ–Ω, —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ –≤ Vercel!

### –®–∞–≥ 2: –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook

```bash
pnpm bot:webhook
```

**–¢–µ–ø–µ—Ä—å –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:**

```
üîß Setting Telegram webhook...
üìç Webhook URL: https://matchvibesmain.vercel.app/api/bot/webhook
üîí Using webhook secret: GlUM...Wfyi
‚úÖ Webhook set successfully!
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

1. **–í –∫–æ–Ω—Å–æ–ª–∏ —Å–∫—Ä–∏–ø—Ç–∞** –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:

   ```
   üîí Using webhook secret: GlUM...Wfyi
   ‚úÖ Webhook set successfully!
   ```

2. **–í Vercel –ª–æ–≥–∞—Ö** –æ—à–∏–±–∫–∏ –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å:
   - ‚ùå –ë—ã–ª–æ: `Invalid webhook secret token` (401)
   - ‚úÖ –°—Ç–∞–ª–æ: `200 OK` –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫

3. **–ë–æ—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å** –Ω–æ—Ä–º–∞–ª—å–Ω–æ

---

## üìù –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### –û–±–Ω–æ–≤–ª—ë–Ω —Ñ–∞–π–ª: `scripts/set-webhook.ts`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**

- –ß—Ç–µ–Ω–∏–µ `TELEGRAM_WEBHOOK_SECRET` –∏–∑ env
- –ü–µ—Ä–µ–¥–∞—á–∞ `secret_token` –≤ Telegram –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ webhook
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è secret (—Å –º–∞—Å–∫–∏—Ä–æ–≤–∫–æ–π)

**–ë—ã–ª–æ:**

```typescript
body: JSON.stringify({
  url: WEBHOOK_URL,
  allowed_updates: ['message', 'callback_query', 'inline_query'],
  drop_pending_updates: true,
})
```

**–°—Ç–∞–ª–æ:**

```typescript
const webhookConfig: any = {
  url: WEBHOOK_URL,
  allowed_updates: ['message', 'callback_query', 'inline_query'],
  drop_pending_updates: true,
}

// Add secret_token if available
if (WEBHOOK_SECRET) {
  webhookConfig.secret_token = WEBHOOK_SECRET
}

body: JSON.stringify(webhookConfig)
```

---

## üîÑ –ü–æ–ª–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å:

### 1. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```powershell
-join ((48..57) + (65..90) + (97..122) | Get-Random -Count 32 | % {[char]$_})
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –≤ Vercel

```
Settings ‚Üí Environment Variables
Name: TELEGRAM_WEBHOOK_SECRET
Value: –≤–∞—à_—Ç–æ–∫–µ–Ω
Environments: Production, Preview, Development
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –≤ .env.local

```bash
TELEGRAM_WEBHOOK_SECRET=–≤–∞—à_—Ç–æ–∫–µ–Ω
```

### 4. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook

```bash
pnpm bot:webhook
```

### 5. Redeploy Vercel (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —à–∞–≥–∞ 4 –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å, —Å–¥–µ–ª–∞–π—Ç–µ redeploy:

```
Vercel Dashboard ‚Üí Deployments ‚Üí ... ‚Üí Redeploy
```

---

## ‚ùì FAQ

### Q: –ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞?

**A:** Telegram –Ω–µ –∑–Ω–∞–ª –ø—Ä–æ secret —Ç–æ–∫–µ–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ webhook –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `secret_token`. Vercel –ø—Ä–æ–≤–µ—Ä—è–ª —Ç–æ–∫–µ–Ω, –∞ Telegram –µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª.

### Q: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ª–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ .env.local?

**A:** –î–∞, –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞. –ò–Ω–∞—á–µ —Å–∫—Ä–∏–ø—Ç –Ω–µ —Å–º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–æ–∫–µ–Ω –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—Å—Ç –µ–≥–æ –≤ Telegram.

### Q: –¢–æ–∫–µ–Ω—ã –≤ Vercel –∏ .env.local –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å?

**A:** –î–∞! –≠—Ç–æ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–æ–∫–µ–Ω. Vercel –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –∞ —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç –µ–≥–æ –≤ Telegram.

### Q: –ß—Ç–æ –µ—Å–ª–∏ –æ—à–∏–±–∫–∏ –Ω–µ –∏—Å—á–µ–∑–ª–∏?

**A:** –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:

1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ç–æ–∫–µ–Ω—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç (Vercel –∏ .env.local)
2. –°–¥–µ–ª–∞—Ç—å redeploy –≤ Vercel
3. –ï—â—ë —Ä–∞–∑ –∑–∞–ø—É—Å—Ç–∏—Ç—å `pnpm bot:webhook`

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —à–∞–≥–æ–≤:

- ‚úÖ Telegram –∑–Ω–∞–µ—Ç –ø—Ä–æ secret —Ç–æ–∫–µ–Ω
- ‚úÖ Vercel –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ 401
- ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç–æ–π

**–ó–∞–ø—É—Å–∫–∞–π—Ç–µ `pnpm bot:webhook` –∏ –≤—Å—ë –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!** üöÄ
