# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TELEGRAM_WEBHOOK_SECRET

**–î–∞—Ç–∞:** 2025-01-09  
**–°—Ç–∞—Ç—É—Å:** –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

---

## üîí –ß—Ç–æ —ç—Ç–æ?

`TELEGRAM_WEBHOOK_SECRET` - —ç—Ç–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Telegram –∫ –≤–∞—à–µ–º—É webhook. –≠—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

## ‚ö†Ô∏è –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

**–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:**

```
TELEGRAM_WEBHOOK_SECRET not set, skipping verification
```

–≠—Ç–æ **–ù–ï –æ—à–∏–±–∫–∞**, —ç—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (warning). –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ:

- ‚úÖ Webhook –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
- ‚ö†Ô∏è –ë–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

---

## üöÄ –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

### –®–∞–≥ 1: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —Å—Ç—Ä–æ–∫:

```bash
# PowerShell
-join ((48..57) + (65..90) + (97..122) | Get-Random -Count 32 | % {[char]$_})

# –ò–ª–∏ –æ–Ω–ª–∞–π–Ω:
# https://www.random.org/strings/
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

- –î–ª–∏–Ω–∞: 1-256 —Å–∏–º–≤–æ–ª–æ–≤
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 32-64 —Å–∏–º–≤–æ–ª–∞
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: A-Z, a-z, 0-9, \_ (underscore), - (dash)

**–ü—Ä–∏–º–µ—Ä:**

```
MySecretWebhookToken123_ABC-xyz
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –≤ Environment Variables

#### –í Vercel:

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://vercel.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç MatchVibe
3. Settings ‚Üí Environment Variables
4. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
   - **Name:** `TELEGRAM_WEBHOOK_SECRET`
   - **Value:** `–≤–∞—à_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_—Ç–æ–∫–µ–Ω`
   - **Environment:** Production, Preview, Development (–≤—Å–µ)
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
6. **Redeploy** –ø—Ä–æ–µ–∫—Ç

#### –õ–æ–∫–∞–ª—å–Ω–æ (.env.local):

```bash
TELEGRAM_WEBHOOK_SECRET=–≤–∞—à_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_—Ç–æ–∫–µ–Ω
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook —Å —Å–µ–∫—Ä–µ—Ç–æ–º

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ Vercel, –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook:

```bash
pnpm bot:webhook
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
  -d "url=https://your-app.vercel.app/api/bot/webhook" \
  -d "secret_token=–≤–∞—à_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_—Ç–æ–∫–µ–Ω"
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:

```
‚úÖ Webhook signature verified
```

–í–º–µ—Å—Ç–æ:

```
‚ö†Ô∏è TELEGRAM_WEBHOOK_SECRET not set, skipping verification
```

---

## ‚ùì –ù—É–∂–Ω–æ –ª–∏ —ç—Ç–æ –¥–µ–ª–∞—Ç—å?

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –µ—Å–ª–∏:

- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ production
- –•–æ—Ç–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–∞–∂–Ω–∞

### ‚ö†Ô∏è –ú–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –µ—Å–ª–∏:

- –¢–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏/—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ –∞—Ç–∞–∫
- –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø

---

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ webhook Telegram –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –≤–∞—à `secret_token`
2. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –æ—Ç Telegram –≤–∫–ª—é—á–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:
   ```
   X-Telegram-Bot-Api-Secret-Token: –≤–∞—à_—Ç–æ–∫–µ–Ω
   ```
3. –í–∞—à —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–æ–≤–ø–∞–¥–∞–µ—Ç
4. –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí –∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∞—Ç–∞–∫–∞)

### –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):

```typescript
// src/app/api/bot/webhook/route.ts
const secret = process.env.TELEGRAM_WEBHOOK_SECRET
if (secret) {
  const headerSecret = request.headers.get('X-Telegram-Bot-Api-Secret-Token')
  if (headerSecret !== secret) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }
}
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Telegram

https://core.telegram.org/bots/api#setwebhook

> secret*token: Optional. A secret token to be sent in a header "X-Telegram-Bot-Api-Secret-Token" in every webhook request, 1-256 characters. Only characters A-Z, a-z, 0-9, * and - are allowed.

---

## ‚úÖ –ò—Ç–æ–≥

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ `TELEGRAM_WEBHOOK_SECRET`  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –¥–ª—è production  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –ø–æ–ª–µ–∑–Ω–æ)

**–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–µ–π—á–∞—Å** - –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ warning –≤ –ª–æ–≥–∞—Ö. –ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ.
