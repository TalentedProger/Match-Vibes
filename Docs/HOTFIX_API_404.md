# HOTFIX: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 404 –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–æ–ø—Ä–æ—Å–æ–≤

**–î–∞—Ç–∞:** 2025-01-09  
**–í–µ—Ä—Å–∏—è:** 1.1  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ CRITICAL

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π API –≤–æ–∑–≤—Ä–∞—â–∞–ª 404 –¥–ª—è `/api/categories/{id}/questions`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ **–±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ** –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –∏–≥—Ä—ã.

### –õ–æ–≥–∏ –æ—à–∏–±–æ–∫:

```
GET 404 /api/categories/4b243a46-6aff-4438-8f9b-14cdc1fea805/questions
GET 404 /api/categories/e1df7799-3f7d-4d3e-8cfa-a89695a2c0f8/questions
```

### –ü—Ä–∏—á–∏–Ω–∞:

–õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –±—ã–ª–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π:

- API –∏—Å–∫–∞–ª –≤–æ–ø—Ä–æ—Å—ã —Å `category_id = X`
- –ù–æ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç —Ç–æ–ª—å–∫–æ `subcategory_id`, –∞ –Ω–µ –ø—Ä—è–º–æ–π `category_id`
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ ‚Üí 404 –æ—à–∏–±–∫–∞

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ API:

**–°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è):**

```typescript
// –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –∏—Å–∫–∞–ª–æ –Ω–∞–ø—Ä—è–º—É—é –ø–æ category_id
if (subcategoryId) {
  query = query.eq('subcategory_id', subcategoryId)
} else {
  query = query.eq('category_id', categoryId) // ‚ùå –í–æ–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç!
}
```

**–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è):**

```typescript
if (subcategoryId) {
  // –§–∏–ª—å—Ç—Ä –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  query = supabase
    .from('questions')
    .select('id, text, image_url, order_index, subcategory_id')
    .eq('subcategory_id', subcategoryId)
    .eq('is_active', true)
} else {
  // –ó–∞–≥—Ä—É–∑–∏—Ç—å –í–°–ï –≤–æ–ø—Ä–æ—Å—ã –∏–∑ –≤—Å–µ—Ö –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const { data: subcategories } = await supabase
    .from('subcategories')
    .select('id')
    .eq('category_id', categoryId)

  const subcategoryIds = subcategories?.map(s => s.id) || []

  query = supabase
    .from('questions')
    .select('id, text, image_url, order_index, subcategory_id')
    .in('subcategory_id', subcategoryIds) // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!
    .eq('is_active', true)
}
```

---

## üìù –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. `src/app/api/categories/[id]/questions/route.ts`

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ 1: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

- –ï—Å–ª–∏ `subcategoryId` —É–∫–∞–∑–∞–Ω ‚Üí —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ï—Å–ª–∏ –ù–ï —É–∫–∞–∑–∞–Ω ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ –≤—Å–µ—Ö –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ 2: –£–±—Ä–∞–Ω–∞ –æ—à–∏–±–∫–∞ 404 –ø—Ä–∏ –ø—É—Å—Ç–æ–º –º–∞—Å—Å–∏–≤–µ

### 2. `src/app/api/game/[roomId]/calculate/route.ts`

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ: –¢–∞ –∂–µ –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –¢–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –∏–∑ –≤—Å–µ—Ö –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π, –µ—Å–ª–∏ `subcategory_id` –Ω–µ —É–∫–∞–∑–∞–Ω

### 3. `src/app/(main)/game/[roomId]/page.tsx`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –≤–æ–ø—Ä–æ—Å–æ–≤:

```typescript
// Check if questions exist
if (!data.questions || data.questions.length === 0) {
  setError('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏')
  return
}
```

---

## üîç –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –í—ã–±—Ä–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ë–ï–ó –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è)
             ‚Üì
–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã: { category_id: "xxx", subcategory_id: null }
             ‚Üì
API –∑–∞–ø—Ä–æ—Å: GET /api/categories/xxx/questions
             ‚Üì
API –∑–∞–≥—Ä—É–∂–∞–µ—Ç: subcategories WHERE category_id = "xxx"
             ‚Üì
API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: questions WHERE subcategory_id IN [sub1, sub2, sub3]
             ‚Üì
–ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–æ –≤—Å–µ–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í—ã–±—Ä–∞–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏ ‚Üí –ó–∞–≤—Ç—Ä–∞–∫ –º–µ—á—Ç—ã
             ‚Üì
–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã: { category_id: "xxx", subcategory_id: "yyy" }
             ‚Üì
API –∑–∞–ø—Ä–æ—Å: GET /api/categories/xxx/questions?subcategoryId=yyy
             ‚Üì
API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: questions WHERE subcategory_id = "yyy"
             ‚Üì
–ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ "–ó–∞–≤—Ç—Ä–∞–∫ –º–µ—á—Ç—ã"
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ù–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å SQL —Å–∫—Ä–∏–ø—Ç—ã

SQL —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (`add_subcategory_to_rooms.sql`) **–û–ü–¶–ò–û–ù–ê–õ–¨–ù–´**.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ **–ë–ï–ó** –ø–æ–ª—è `subcategory_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `rooms`.

### –ü–æ—á–µ–º—É?

- –°—Ç–∞—Ä—ã–µ –∫–æ–º–Ω–∞—Ç—ã –±–µ–∑ `subcategory_id` –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –û–Ω–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ)
- –ù–æ–≤—ã–µ –∫–æ–º–Ω–∞—Ç—ã —Å `subcategory_id` –±—É–¥—É—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏

**–í—ã–≤–æ–¥:** –ú–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —É–¥–æ–±–Ω–æ.

---

## üöÄ –î–µ–ø–ª–æ–π

```bash
# –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .
git commit -m "hotfix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ 404 –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–æ–ø—Ä–æ—Å–æ–≤"
git push origin main
```

Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
2. **–í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é**
3. **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—É**
4. **–ù–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É**
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
   - ‚úÖ –í–æ–ø—Ä–æ—Å—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
   - ‚úÖ –ù–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
   - ‚úÖ –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Vercel Logs:

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

```
GET 200 /api/categories/{id}/questions  ‚úÖ
```

–í–º–µ—Å—Ç–æ:

```
GET 404 /api/categories/{id}/questions  ‚ùå
```

---

## üêõ –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel

- –û—Ç–∫—Ä–æ–π—Ç–µ Vercel Dashboard
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª Logs
- –ù–∞–π–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤ API `/api/categories/[id]/questions`

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ subcategories —Å—É—â–µ—Å—Ç–≤—É—é—Ç
SELECT c.name as category, COUNT(sc.id) as subcategory_count
FROM categories c
LEFT JOIN subcategories sc ON sc.category_id = c.id
GROUP BY c.name;

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
SELECT COUNT(*) as total_questions,
       COUNT(subcategory_id) as with_subcategory,
       COUNT(category_id) as with_category
FROM questions;
```

### 3. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
rm -rf .next

# –í Vercel
Settings ‚Üí General ‚Üí Clear Cache ‚Üí Redeploy
```

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:

```
categories (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
    ‚Üì
subcategories (–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
    ‚Üì
questions (–≤–æ–ø—Ä–æ—Å—ã)
```

**–í–∞–∂–Ω–æ:** –í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∏–º–µ—é—Ç `subcategory_id`, –∞ –Ω–µ –ø—Ä—è–º–æ–π `category_id`.

### API Response:

```json
{
  "questions": [
    {
      "id": "uuid",
      "text": "–ü–∞–Ω–∫–µ–π–∫–∏ —Å —è–≥–æ–¥–∞–º–∏",
      "image_url": "/images/subcategories/food-dream-breakfast/card-1.jpg",
      "order_index": 1,
      "subcategory_id": "uuid"
    }
  ],
  "count": 15
}
```

---

## üéØ –ò—Ç–æ–≥

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ 404
- ‚úÖ –£–±—Ä–∞–Ω–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- ‚úÖ –ò–≥—Ä–∞ —Å–Ω–æ–≤–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –∫–æ–º–Ω–∞—Ç–∞–º–∏

**–í—Å—ë –≥–æ—Ç–æ–≤–æ –¥–ª—è –¥–µ–ø–ª–æ—è!** üöÄ
